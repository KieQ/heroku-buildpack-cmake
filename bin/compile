#!/usr/bin/env bash
# bin/compile <build-dir> <cache-dir>

set -e
set -o pipefail

# environment
BUILD_DIR=$1
CACHE_DIR=$2
CC=gcc-9
CXX=g++-9


# make bin directory to hold the temporary files
cd $BUILD_DIR

# download the submodule use git submodule. This is done by another buildpack.
echo "-----> Install Conan"
python3 -m pip install pkg_resources
pip3 install â€”-upgrade setuptools pip3
pip3 install conan
conan profile new default --detect
conan profile update settings.compiler.libcxx=libstdc++11 default

echo "-----> Delete .git"
rm -rf .git

echo "-----> Change To Build Directory"
mkdir build
cd build

echo "-----> Install Library With Conan"
conan install .. --build=missing

echo "-----> Compiling With CMake"
cmake .. -DCMAKE_BUILD_TYPE=Release
make

echo "-----> Install with make"
make install
cd ..
rm -rf build
